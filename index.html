<html>
	<head>
		<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>
        <script type="text/javascript" src="js/highcharts.js"></script>
		<script type="text/javascript" src="http://code.highcharts.com/highcharts-more.js"></script>
        <script type="text/javascript" src="js/miso.js"></script>
        <script type="text/javascript">

		window.onload = function() {
			chart.loadData();

			var d = [
			{
				name: "United States",
				data: [53.6, 17.6, 27.9, 32.7, 43.1, 35.7, 31.6, 71.8, 65.2, 66.4, 30.5],
				pointPlacement: 'off'
			}, {
				name: "Ukraine",
				data: [42.8, 32.3, 42.3, 19.9, 22.3, 39.4, 45.1, 59.0, 75.5, 85.8, 13.0],
				pointPlacement: 'off'
			}];

			chart.drawChart(d);

		}

		var chart = {

			master_data: [],

			loadData: function() {
				var ds = new Miso.Dataset({
					url: "data/data.csv",
					delimiter: ","
				});
				ds.fetch({
					success: function() {
						var columns = this._columns;
						var highcharts_series_object = [];
						var number_of_columns = columns.length;
						var number_of_rows = columns[0].data.length;
						for (var i = 0; i < number_of_rows; i++) {
							var country_name = [];
							var category_data_points = [];
							for (var j = 1; j < number_of_columns; j++) {
								var d = columns[j].data[i]
								if (typeof d === "number") {
									category_data_points.push(d);
								} else {
									country_name = d;
								}
							}
							highcharts_series_object.push({
								type: "area",
								name: country_name,
								data: category_data_points
							});
						}
						chart.master_data = highcharts_series_object;
					}
				});
			},

			submitList: function() {

				var first_selection = $("#list1 option:selected").text();
				var second_selection = $("#list2 option:selected").text();

				if (first_selection === "--" || second_selection === "--") {
					alert("Please select two countries from the lists");
				} else {

					var args = [];
					for (var i = 0; i < chart.master_data.length; i++) {
						var country = chart.master_data[i].name;
						if ( country == first_selection || country == second_selection ) {
							args.push(chart.master_data[i]);
						}
					}

					chart.drawChart(args);

				}
			},

			drawChart: function(data) {
				console.log(data);
				$("#container").highcharts({
				    chart: {
				        style: {
                            fontFamily: '"Source Sans Pro", Ariel',
                            fontSize: '16px'
                        },
                        polar: true,
				        type: 'area'
				    },
				    title: {
				        text: '',
				    },
				    xAxis: {
				        categories: ['Independence', 'Self-Expression', 'Obedience', 'Unselfishness', 'Religious Faith', 'Determination, Perseverance', 'Thrift', 'Tolerance and Respect for Others', 'Responsibility', 'Hard Work', 'Imagination'],
                        lables: {
                            style: {
                                fontSize: '18px',
                                fontFamily: '"Source Sans Pro", sans serif'
                            },
                        },
				        tickmarkPlacement: 'on',
				        lineWidth: 0
				    },
				    yAxis: {
				        gridLineInterpolation: 'polygon',
				        lineWidth: 2,
				        min: 0
				    },
				    tooltip: {
				        shared: true,
                        style: {
                            fontSize: '14px'
                        },
                        pointFormat: '<b>{series.name}: </b>{point.y}%<br>'
				        //pointFormat: '<span style="color:{series.color}">{series.name}: <b>{point.y:,.0f}</b></br><br>'
				    },
				    legend: {
                        style: {
                            fontSize: '20px'
                        },
				        align: 'top',
				        verticalAlign: 'top',
				        layout: 'vertical'
				    },
				    credits: {
                        position: {
                            align: 'left',
                            x: '10px'
                        },
                        style: {
                            fontSize: '14px'
                        },
				        text: '<strong>Data:</strong> World Values Survey',
                        href: 'http://www.worldvaluessurvey.org/wvs.jsp'
				    },

				    series: data
				});

			}

		}

        </script>
    </head>
    <body>  
        <p id="headline" style=
            "font-family:Source Sans Pro;
             font-weight:600;
             line-height: 140%;
             margin: 0;               
             font-size:40px">Choose two countries to compare
        </p>  
        <p id="blurb" style=
            "font-family:Source Sans Pro;
             font-weight:400;
             margin: 0;
             font-size:16px"><em>Area shows percent of people in that country who named that value.</em>
         </p>
             
        <select id="list1">
			<option>--</option>
            <option>Algeria</option>
            <option>Armenia</option>
            <option>Australia</option>
            <option>Azerbaijan</option>
            <option>Belarus</option>
            <option>Chile</option>
            <option>China</option>
            <option>Colombia</option>
            <option>Cyprus</option>
            <option>Ecuador</option>
            <option>Egypt</option>
            <option>Estonia</option>
            <option>Germany</option>
            <option>Ghana</option>
            <option>Iraq</option>
            <option>Japan</option>
            <option>Jordan</option>
            <option>Kazakhstan</option>
            <option>Kuwait</option>
            <option>Kyrgyzstan</option>
            <option>Lebanon</option>
            <option>Libya</option>
            <option>Malaysia</option>
            <option>Mexico</option>
            <option>Morocco</option>
            <option>Netherlands</option>
            <option>New Zealand</option>
            <option>Nigeria</option>
            <option>Pakistan</option>
            <option>Palestine</option>
            <option>Peru</option>
            <option>Philippines</option>
            <option>Poland</option>
            <option>Qatar</option>
            <option>Romania</option>
            <option>Russia</option>
            <option>Rwanda</option>
            <option>Singapore</option>
            <option>Slovenia</option>
            <option>South Korea</option>
            <option>Spain</option>
            <option>Sweden</option>
            <option>Taiwan</option>
            <option>Trinidad and Tobago</option>
            <option>Tunisia</option>
            <option>Turkey</option>
            <option>Ukraine</option>
            <option>United States</option>
            <option>Uruguay</option>
            <option>Uzbekistan</option>
            <option>Yemen</option>
            <option>Zimbabwe</option>
        </select>    
        <select id="list2">
			<option>--</option>
            <option>Algeria</option>
            <option>Armenia</option>
            <option>Australia</option>
            <option>Azerbaijan</option>
            <option>Belarus</option>
            <option>Chile</option>
            <option>China</option>
            <option>Colombia</option>
            <option>Cyprus</option>
            <option>Ecuador</option>
            <option>Egypt</option>
            <option>Estonia</option>
            <option>Germany</option>
            <option>Ghana</option>
            <option>Iraq</option>
            <option>Japan</option>
            <option>Jordan</option>
            <option>Kazakhstan</option>
            <option>Kuwait</option>
            <option>Kyrgyzstan</option>
            <option>Lebanon</option>
            <option>Libya</option>
            <option>Malaysia</option>
            <option>Mexico</option>
            <option>Morocco</option>
            <option>Netherlands</option>
            <option>New Zealand</option>
            <option>Nigeria</option>
            <option>Pakistan</option>
            <option>Palestine</option>
            <option>Peru</option>
            <option>Philippines</option>
            <option>Poland</option>
            <option>Qatar</option>
            <option>Romania</option>
            <option>Russia</option>
            <option>Rwanda</option>
            <option>Singapore</option>
            <option>Slovenia</option>
            <option>South Korea</option>
            <option>Spain</option>
            <option>Sweden</option>
            <option>Taiwan</option>
            <option>Trinidad and Tobago</option>
            <option>Tunisia</option>
            <option>Turkey</option>
            <option>Ukraine</option>
            <option>United States</option>
            <option>Uruguay</option>
            <option>Uzbekistan</option>
            <option>Yemen</option>
            <option>Zimbabwe</option>
        </select>    
        <button onclick="chart.submitList()" style="font-size: 13px">Compare</button>
        <div id="container" 
            style=
            "min-width: 100%; 
            height: 500px; 
            margin: 0 auto">
        </div>
    </body>
</html>
